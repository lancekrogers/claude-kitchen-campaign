# HemingwayGuard - macOS Text Interception for Messaging Apps

# Default: show available commands
default:
    @just --list

# Build the application
build:
    go build -o bin/hemingway-guard ./cmd/hemingway-guard

# Run the application
run: build
    ./bin/hemingway-guard

# Run tests
test:
    go test -v ./...

# Run tests with race detection
test-race:
    go test -race -v ./...

# Lint the code
lint:
    golangci-lint run ./...

# Format code
fmt:
    go fmt ./...
    goimports -w .

# Clean build artifacts
clean:
    rm -rf bin/

# Install dependencies
deps:
    go mod tidy
    go mod download

# Build .app bundle for distribution
bundle: build
    @echo "Creating .app bundle..."
    mkdir -p "HemingwayGuard.app/Contents/MacOS"
    mkdir -p "HemingwayGuard.app/Contents/Resources"
    cp bin/hemingway-guard "HemingwayGuard.app/Contents/MacOS/"
    cp Info.plist "HemingwayGuard.app/Contents/"
    @echo "Bundle created: HemingwayGuard.app"

# Development mode with hot reload (requires air)
dev:
    air

# Check accessibility permissions
check-permissions:
    @echo "Checking Accessibility permissions..."
    @tccutil reset Accessibility com.hemingway-guard 2>/dev/null || true
    @echo "Please grant Accessibility permissions in System Preferences"
